----1st session



CREATE OR REPLACE TABLE YT.MH.LOG_STEP (ID INTEGER,
                      STEP_DESC TEXT,
                      VALUE NUMBER,
                      LOG_TIME TIMESTAMP);

SELECT * FROM YT.MH.LOG_STEP;
DELETE FROM YT.MH.LOG_STEP ;               



CALL SYSTEM$WAIT(10);


CREATE OR REPLACE PROCEDURE SP_MH_1()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS DECLARE 
V_SP_NAME VARCHAR(50):='SP_MH_1';
ERR_MSG VARCHAR(500);
ERR_STEP VARCHAR(10);
BEGIN
INSERT INTO  YT.MH.LOG_STEP (SELECT 1, 'POINTER AT STEP 1', 10, current_timestamp );
CALL SYSTEM$WAIT(20);
INSERT INTO  YT.MH.LOG_STEP (SELECT 2, 'POINTER AT STEP 2 ITS 20', 20, current_timestamp );
 
RETURN :V_SP_NAME|| 'EXECUTED SUCCESSFULLY';
EXCEPTION
WHEN OTHER THEN
RETURN 'ERROR IN CODE';                            
RAISE;                                
END;

CALL YT.MH.SP_MH_1();

SELECT * FROM YT.MH.LOG_STEP;
DELETE FROM YT.MH.LOG_STEP ; 





---2nd session


CREATE OR REPLACE PROCEDURE SP_MH_1()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS DECLARE 
V_SP_NAME VARCHAR(50):='SP_MH_1';
ERR_MSG VARCHAR(500);
ERR_STEP VARCHAR(10);
BEGIN
INSERT INTO  YT.MH.LOG_STEP (SELECT 1, 'POINTER AT STEP 1', 10, current_timestamp );
CALL SYSTEM$WAIT(20);
INSERT INTO  YT.MH.LOG_STEP (SELECT 2, 'POINTER AT STEP 2 I CHANGED VALUE', 30, current_timestamp );
 
RETURN :V_SP_NAME|| 'EXECUTED SUCCESSFULLY';
EXCEPTION
WHEN OTHER THEN
RETURN 'ERROR IN CODE';                            
RAISE;                                
END;

CALL YT.MH.SP_MH_1();

SELECT * FROM YT.MH.LOG_STEP;
DELETE FROM YT.MH.LOG_STEP ;  
